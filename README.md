# KKM
implementation of the King-Knudson-Mramor algorithm in discrete Morse theory

This software requires QHull: http://qhull.org/  

These instructions originally written by Henry King in 2005: https://math.umd.edu/~hking/MorseExtract.html 

This software implements an algorithm from the paper Generating discrete Morse functions from point data by Henry King, Kevin Knudson, and Neža Mramor.  This algorithm takes a function on the vertices of a 3 dimensional simplicial complex and converts it into a discrete Morse function in the sense of Forman.  It also cancels pairs of critical simplices which are connected by a single gradient path and whose values differ by less than a prescribed persistence.

	•	The algorithm is implemented in main2.c view.c simplex.c list.c globals.c homology.c cancel.c globals.h Morse.h list.h simplex.h cancel.h and mytypes.h All but the first two and last of these are generated by the CWeb files simplex.w list.w homology.w and cancel.w.
	•	randomvertices.c generates random points in 3 dimensional space and calculates function values at those points.  As is, it uses the function x^3-x+y^3-y+z^3-z, but this is easily changed to whatever the user wishes.
	•	enclose.c takes a vertex file and adds four more vertices which enclose the region in a tetrahedron, this is needed for some technical reason, to make it easy to close up the Delaunay triangulation to a 3 sphere.
	•	qhprep1.c takes the output of enclose.c, and produces a file suitable for input to a program qdelaunay (available from here) which produces a triangulation with the given points as vertices.  

Compiling the programs:
    These programs can be compiled using the commands:
	•	gcc -O3 randomvertices.c -o randomvertices
	•	gcc -O3 enclose.c -o enclose
	•	gcc -O3 qhprep1.c -o qhprep
	•	gcc -O3 main2.c view.c simplex.c list.c globals.c homology.c cancel.c -lobjc -framework OpenGL -framework GLUT -o extract 
    The last command works on a Mac running OSX but needs to be changed for other platforms so  OpenGL can be accessed.  Perhaps the following will work:
	•	gcc -O3 main.c view.c simplex.c list.c globals.c homology.c cancel.c -o extract -lglut -lGLU -lGL -lXmu -lXi -lXext -lX11 -lm 
Running the programs:
    Here is a sample run.

./randomvertices 30000 > fv
./enclose fv
./qhprep fv | qdelaunay QJ i > ft
./extract -v fv -q ft

    The first command generates 30000 random points and assigns a value to each.  The second command encloses the points in a tetrahedron. The third finds a triangulation with the points as vertices.  The last command computes a discrete Morse function and allows you to visualize it.  You should be presented with a window with a black background, some white dots (which are the vertices) and some colored balls, some with lines coming from them (these are the critical simplices, The balls are around the barycenter of the simplex and the lines go to the barycenters of its codimension one faces.  Possibly a purple ball representing a critical vertex fills the window initially.)  

Navigating in the viewer:

Keyboard actions:
	•	space = move forward
	•	v = move backward
	•	b,c = rotate around some up-down axis
	•	f,g = rotate around some up-down axis through the selected simplex and also translate this simplex to the center
	•	q = quit
Mouse actions:
	•	Use left mouse button to drag and rotate scene.
	•	Use middle mouse button to select a critical simplex.
	•	Use right mouse button to select from menu-
	◦	Display/Hide 0-1 gradient paths = display grad paths to a selected vertex or from a selected edge.
	◦	Display/Hide 1-2 gradient paths = display grad paths to a selected edge or from a selected triangle.  Only lines connecting the barycenters of the edges and triangles in the grad path are shown.
	◦	Display/Hide 2-3 gradient paths = display grad paths to a selected triangle or from a selected tetrahedron.  Only lines connecting the barycenters of the tetrahedra and triangles in the grad path are shown.
	◦	Display/Hide descending 2 discs = display all grad paths to a selected edge or from a selected triangle.  All triangles in the grad paths are displayed.
	◦	Display/Hide link = display the link of the highest vertex of the selected simplex.  The lower link is shown in red.
	◦	Display/Hide lower link = display the lower link of the highest vertex of the selected simplex. 
	◦	Cancel 0-1 = Do persistence canceling of vertices and edges, then double the persistence for the next canceling, so each time you click it you cancel more and more.
	◦	Cancel 1-2 = Do persistence canceling of triangles and edges, then double the persistence for the next canceling.
	◦	Cancel 2-3 = Do persistence canceling of triangles and tetrahedra, then double the persistence for the next canceling.
	◦	Compute Z/pZ Betti numbers = Compute the Betti numbers for Z/pZ homology for all primes p <= 37.
	◦	set/reset option = display actual smooth gradient paths for the function x^3-x+y^3-y+z^3-z, they appear in red.  You can use this to compare the smooth paths to their combinatorial approximations.  Also after this is clicked on, I think I have it set up so that when descending 2 discs are displayed, only those going between critical simplices are displayed.  Before clicking, all grad paths are displayed, even those not ending at a critical edge.
Command line options:

    extract has the following command line options:

-v fv  A file of vertices, must be present

-q ft  A file of tetrahedra, in the format output by qdelaunay.  If neither the -q or -t option is given, it is assumed the tetrahedron file is on stdin in the qdelaunay format.

-t file  Use instead of -q if you have a plain tetrahedron file,  without the extra stuff from qdelaunay.
        
-p persistence  The persistence amount, default = .1.
        
-h maxh  any two vertices with values above this will be considered to have equal value for persistence purposes, default = 1.
        
-l minh  any two vertices with values below this will be considered to have equal value for persistence purposes. default = 0.
        
-x scalex  scale all x values by dividing by this factor, default = 1.

-y scaley  scale all x values by dividing by this factor, default = 1.

-z scalez  scale all x values by dividing by this factor, default = 1.

-o val  A more complicated method is used to assign values to vertices in the lower link which might give a discrete vector field which more closely approximates an underlying smooth vector field.  It's not clear it makes much difference.  The following argument val is ignored, but must be present.
